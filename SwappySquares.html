<html>    
<head>
<title>Swappy Squares</title>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0px;
            border: 0;
            overflow: hidden; /*  Disable scrollbars */
            display: block;  /* No floating content on sides */
        }
    </style>
</head>

<body>
<canvas id='canvas' style = 'position: absolute; left: 0px; top: 0px;' ></canvas>

<script src = "Scripts/levels.js"></script>
    
<script>
    //AudioFiles
    var music = new Audio("Audio/menuAudio.mp3");
  
    var cvs = document.getElementById('canvas');
    var ctx = cvs.getContext('2d');


    var bgImage = new Image();
    bgImage.src = "Images/Background.png";
    var squareSize;

    var ssImage = new Image();
    ssImage.src = "Images/SS.png";

    //Variables
    var squareSize;
    var topLeftx;
    var topLefty;
    var boxNo = 11;
    var boxSize;
    var levelCount = 1;
    var loader = 0;
    var player;
    var playeri; //i is rows
    var playerj; //j is columns
    var level;
    var levelRows;
    var levelCols;
    var player_colour = 'red';

    var walls = new Array(0);

    var centreX;
    var centreY;

    var isLeft = false;
    var isRight = false;
    var isSpace = false;
    var isUp = false;
    var isDown = false;
    var isKeyDown = false;

    //Register click event
    window.addEventListener("click", processClick, false);
    
    function processClick(){

    }
    //Register resize event
    window.addEventListener('resize', resizeCanvas, false);

    //Run initial 'resize' to get screen size and draw
    resizeCanvas();

  //document.onkeydown = checkKey;
    window.addEventListener("keydown", keyDown, false);
    window.addEventListener("keyup", keyUp, false);

    function keyDown(e){
        isKeyDown = true;
        if(e.keyCode =='37') isLeft = true;
        if(e.keyCode == '39') isRight = true;
        if(e.keyCode == '32') isSpace = true;
        if(e.keyCode == '38') isUp = true;
        if(e.keyCode == '40') isDown = true;
    }

    function keyUp(e){
        isKeyDown = false;
        if(e.keyCode =='37') isLeft = false;
        if(e.keyCode == '39') isRight = false;
        if(e.keyCode == '32') isSpace = false;
        if(e.keyCode == '38') isUp = false;
        if(e.keyCode == '40') isDown = false;
    }
    

    function level_check(){
    	if(levelCount == 1){
        	level = levelOne.slice();
    	}
    	   levelRows = level.length;
    	   levelCols = level[0].length;

    }
        
    function win(){
        levelCount++;
        loader = 0;


        //Maybe add some graphics here
    }   
                
    // Draw game.                 
    function draw() {
        if(loader==0){
            level_check();
            loader = 1;
        }

        //Draw background
        ctx.drawImage(bgImage, topLeftx, topLefty, squareSize, squareSize);

        //Draw swappy squares
        ctx.drawImage(ssImage, topLeftx+(boxNo/2*boxSize)-(boxSize*3/2), topLefty, boxSize*3, boxSize);

        //Draw level number
        ctx.textAlign="right"; 
        ctx.textBaseline = "bottom";
        ctx.fillStyle = 'black';
        ctx.font = "30px Arial";
        ctx.fillText("Level " + levelCount, topLeftx+10*boxSize, topLefty+boxSize);
        
        //Draw transparent game background
        ctx.fillStyle = 'rgba(225,225,225,0.5)';
        ctx.fillRect(topLeftx+boxSize, topLefty+boxSize, squareSize-2*boxSize, squareSize-2*boxSize);

        //Draw game box outline
        ctx.strokeStyle = 'black';
        ctx.lineWidth = '5';
        ctx.strokeRect(topLeftx+boxSize, topLefty+boxSize, squareSize-2*boxSize, squareSize-2*boxSize);

        //Draw Player in centre and find offset values.
        ctx.fillStyle = player_colour;
        for(var i = 0; i<levelRows; i++){
	        for(var j = 0; j<levelCols;j++){
	            if(level[i][j]=="player"){
                    playeri = i;
                    playerj = j;
		            offseti = i-5;
		            offsetj = j-5;
                    ctx.fillRect(centreX, centreY, boxSize, boxSize);

                    ctx.strokeStyle = 'rgb(255,223,0)';
                    ctx.lineWidth = '5';
                    ctx.strokeRect(centreX, centreY, boxSize, boxSize);
                    
	            }
	        }
	    }

        //Draw everything else
        for(var i = 0; i<levelRows; i++){
            for(var j = 0; j<levelCols;j++){

            	if (level[i][j] == "player"){
            		ctx.fillStyle = player_colour;
            	}
            	else{
            		ctx.fillStyle = level[i][j];
            	}
            	ctx.fillRect(topLeftx+(j-offsetj)*boxSize, topLefty+(i-offseti)*boxSize, boxSize, boxSize);
            	if (level[i][j] == "gold"){
            		ctx.fillStyle = 'black';
                    ctx.textAlign="center"; 
                    ctx.textBaseline = "middle";
                    ctx.font = "15px Arial";
                    ctx.fillText("GOAL", topLeftx+(j-offsetj)*boxSize+0.5*boxSize, topLefty+(i-offseti)*boxSize+0.5*boxSize);
            	}
            	/*
                if(level[i][j]==0){
                    ctx.fillStyle = 'black';
                    ctx.fillRect(topLeftx+(j-offsetj)*boxSize, topLefty+(i-offseti)*boxSize, boxSize, boxSize);
                }

                if(level[i][j]==1){
                    ctx.fillStyle = 'red';
                    ctx.fillRect(topLeftx+(j-offsetj)*boxSize, topLefty+(i-offseti)*boxSize, boxSize, boxSize);
                }

                if(level[i][j]==2){
                    ctx.fillStyle = 'blue';
                    ctx.fillRect(topLeftx+(j-offsetj)*boxSize, topLefty+(i-offseti)*boxSize, boxSize, boxSize);
                }

                if(level[i][j]==3){
                    ctx.fillStyle = 'green';
                    ctx.fillRect(topLeftx+(j-offsetj)*boxSize, topLefty+(i-offseti)*boxSize, boxSize, boxSize);
                }

                if(level[i][j]==9){
                    ctx.fillStyle = 'rgb(255,223,0)';

                    ctx.fillRect(topLeftx+(j-offsetj)*boxSize, topLefty+(i-offseti)*boxSize, boxSize, boxSize);
                    ctx.fillStyle = 'black';
                    ctx.textAlign="center"; 
                    ctx.textBaseline = "middle";
                    ctx.font = "15px Arial";
                    ctx.fillText("GOAL", topLeftx+(j-offsetj)*boxSize+0.5*boxSize, topLefty+(i-offseti)*boxSize+0.5*boxSize);
                }
                */

            }
        }


        
        //Movement logic
        if(isKeyDown) movementLogic();

	    window.requestAnimationFrame(draw); //this is apparently smoother than setInterval, not sure why
	}


    function movementLogic(){
        //console.log("playeri = ", playeri);
        //console.log("playerj = ", playerj);

        if(isRight && playerj+1 < level[playeri].length){ 
        	if (level[playeri][playerj+1] == player_colour){
	            swap(playeri,playerj,playeri,playerj+1);
	            isRight = false;
	        }
        }

        if(isLeft && playerj-1 >= 0){ 
        	if (level[playeri][playerj-1] == player_colour){
	            swap(playeri,playerj,playeri,playerj-1);
	            isLeft = false;
	        }
        }

        if(isDown && playeri+1 < level.length){
        	if (level[playeri+1][playerj] == player_colour){
            	swap(playeri,playerj,playeri+1,playerj);
            	isDown = false;
            }
        }

        if(isUp && playeri-1 >= 0){
        	if (level[playeri-1][playerj] == player_colour){
            	swap(playeri,playerj,playeri-1,playerj);
            	isUp = false;
            }
        }
    }
    

    // Runs each time the DOM window resize event fires.
    // Resets the canvas dimensions to match window,
    // then draws the new borders accordingly.
    function resizeCanvas() {
        cvs.width = window.innerWidth;
        cvs.height = window.innerHeight;
            
        if(window.innerWidth>window.innerHeight){
            squareSize = window.innerHeight; 
            topLeftx = (window.innerWidth-window.innerHeight)/2;
            topLefty = 0;
        }
        else{
            squareSize = window.innerWidth; 
            topLeftx = 0;
            topLefty = (window.innerHeight-window.innerWidth)/2;
        }

        //Sets size of the Swappy Squares
        boxSize = squareSize/boxNo;
        centreX = topLeftx+(5*boxSize);
        centreY = topLefty+(5*boxSize);

        //draw();
    }


    function swap(x1,y1,x2,y2){
        var temp = level[x1][y1];
        level[x1][y1] = level[x2][y2];
        level[x2][y2] = temp;
    }


    //let game = setInterval(draw,100);
    window.requestAnimationFrame(draw);
</script>
    
</body>

</html>